
### 物品规则计算方式
1.禁止扔 2.禁止交易 4.禁止存 8.禁止修 16.禁止出售 32.禁止爆出 64.丢弃消失 128.死亡必爆 256.禁止拍卖 512.禁止挑战 1024.爆出消失
* 很多设置物品规则的地方，可以根据业务需要，优先定义好。
例如：（绑定属性为 禁止扔，禁止交易，禁止出售）
那么对应的物品规则为：1+2+16 = 19，在后面需要传物品规则地方，只要传19进去即可

### 给物品

 `giveitem`

| 参数     | 类型      | 空   | 默认                | 注释                                                                                                                                   |
| :------- | :-------- | :--- | :------------------ | :------------------------------------------------------------------------------------------------------------------------------------- |
| play     | `object`  | 否   |                     | 玩家对象                                                                                                                               |
| itemname | `string`  | 否   |                     | 物品名称                                                                                                                               |
| qty      | `integer` | 是   | 1                   | 数量                                                                                                                                   |
| bind     | `integer` | 是   | 0                   | 物品规则                                                                                                                               |
| desc     | `string`  | 是   | 引擎64_24.05.23新增 | 描述                                                                                                                                   |
| result   | `object`  | 否   |                     | 返回值(最后一个物品对象)，不建议使用在叠加物品，一次性给多个物品的情况，此物品在添加背包触发后，注意可能被回收的情况 生成失败则返回nil |

```lua
    local item = giveitem(actor,"木剑",1,128,"测试")
```

### 给物品直接装备

`giveonitem`

| 参数     | 类型      | 空   | 默认                | 注释                                                            |
| :------- | :-------- | :--- | :------------------ | :-------------------------------------------------------------- |
| play     | `object`  | 否   |                     | 玩家对象                                                        |
| where    | `integer` | 否   |                     | [装备位置](http://engine-doc.996m2.com/web/#/9/5041 "装备位置") |
| itemname | `string`  | 否   |                     | 物品名称                                                        |
| qty      | `integer` | 是   | 1                   | 数量                                                            |
| bind     | `integer` | 是   | 0                   | 物品规则                                                        |
| desc     | `string`  | 是   | 引擎64_24.05.23新增 | 描述                                                            |
| result   | `bool`    | 否   |                     | 返回值(是否成功)                                                |

---

### 拿物品

 `takeitem`

&gt; **&lt;font color="#FF0000" style="font-size: 13px;"&gt;注:务必判断返回值,是否扣除物品成功,引擎锁定的物品并不会被扣除!&lt;/font&gt;**

 
| 参数     | 类型      | 空   | 默认                | 注释                                       |
| :------- | :-------- | :--- | :------------------ | :----------------------------------------- |
| play     | `object`  | 否   |                     | 玩家对象                                   |
| itemName | `string`  | 否   |                     | 物品名称                                   |
| itemNum  | `integer` | 是   |                     | 数量                                       |
| IgnoreJP | `integer` | 是   |                     | 忽略极品<br />0：所有都扣除<br />1：极品不扣除 |
| desc     | `string`  | 是   | 引擎64_24.05.23新增 | 描述                                       |
| result   | `bool`    | 是   |                     | true：成功<br />false：失败                  |
```lua
if not takeitem(actor,"木剑",2) then
    return say(actor,"物品扣除失败")
end
```

### 拿物品(拓展)

 `takeitemex`

&gt; **&lt;font color="#FF0000" style="font-size: 13px;"&gt;注:务必判断返回值,是否扣除物品成功,引擎锁定的物品并不会被扣除!&lt;/font&gt;**

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_23.12.07新增接口&lt;/font&gt;**
 
| 参数     | 类型      | 空   | 默认 | 注释                                         |
| :------- | :-------- | :--- | :--- | :------------------------------------------- |
| play     | `object`  | 否   |      | 玩家对象                                     |
| itemName | `string`  | 否   |      | 物品名称                                     |
| itemNum  | `integer` | 是   |      | 数量                                         |
| bind     | `integer` | 是   |      | 0=忽略<br />1=扣除非绑定物品<br />2=扣除绑定物品 |
| desc     | `string`  | 是   |      | 描述                                         |
| result   | `bool`    | 是   |      | true：成功<br />false：失败                    |
```lua
if not takeitemex(actor, "木剑", 3,1,"奖励") then
    return say(actor,"物品扣除失败")
end
```

### 通过物品唯一id拿走物品

`delitembymakeindex`

&gt; **&lt;font color="#FF0000" style="font-size: 13px;"&gt;注:务必判断返回值,是否扣除物品成功,引擎锁定的物品并不会被扣除!&lt;/font&gt;**

| 参数   | 类型      | 空   | 默认                | 注释                                                                   |
| :----- | :-------- | :--- | :------------------ | :--------------------------------------------------------------------- |
| play   | `object`  | 否   |                     | 玩家对象                                                               |
| ids    | `string`  | 否   |                     | 物品唯一ID，逗号(,)串联                                                |
| count  | `integer` | 否   |                     | 叠加物品扣除数量，<br />不填此参数，默认全部扣除<br />不可叠加物品全部扣除 |
| desc   | `string`  | 否   | 引擎64_24.03.14新增 | 描述                                                                   |
| result | `bool`    | 否   |                     | 是否扣除成功                                                           |

### 使用物品（吃药、使用特殊物品等）

`eatitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemname     |`string`        |否   |    |  物品名称   |
|count  |`integer`         |是   |1    |   数量    |

### 根据物品唯一ID获得物品对象

`getitembymakeindex`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|makeindex     | `integer`      |否   |    |物品唯一ID |
|result     |`object`      |否   |    |物品对象 |
```
    会根据makeindex检索玩家装备和背包，返回对应的物品对象，如果检索不到，返回'0'
```

### 根据唯一ID删除仓库物品
 `delstorageitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |---|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemmakeid     |`integer`      |否   |    |   删除唯一ID物品 |

### 根据idx删除仓库物品
 `delstorageitembyidx`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |---|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemidx     |`integer`      |否   |    |   删除所有Idx物品 |

### 物品关联
#### ~~正在操作物品关联~~
`linkpickupitem`   --废弃，以后会在触发参数里，传递过来
&gt; 关联正在操作的物品，捡取，丢弃

#### 关联装备物品
`linkbodyitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |---|------      |
|play     |`object`      |否   |    |   玩家对象 |
|where    |`integer`       |否   |    |   [装备位置](http://engine-doc.996m2.com/web/#/9/5041 "装备位置")  |
|result       |`object`        |否   |   |   返回物品对象    |

### 获取物品信息
`getiteminfo`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |   物品对象   |
|id       |`integer`       |否   |    |   1:唯一ID <br />2:物品ID<br />3:剩余持久<br />4:最大持久<br />5:叠加数量<br />6:绑定状态<br />7:物品名称(引擎64_23.08.30新增)<br />8:物品改名后的名称(引擎64_24.08.07新增)    |
|result |`integer`         |是   |0    |   对应数值，不存在为0    |

### 获取物品基础信息
`getstditeminfo`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|itemid/itemName      |`integer`/`string`      |否   |    |   物品ID/物品名称    |
|id       |`integer`       |否   | 13:物品颜色<br />引擎64_23.0628新增   |0:idx <br /> 1:名称 <br />2:StdMode<br />3:Shape<br />4:重量<br />5:AniCount <br />6:最大持久 <br />7:叠加数量<br />8:价格（price）<br />9:使用条件 <br />10:使用等级<br />11:自定义常量(29列)<br />12:自定义常量(30列)<br />13:道具颜色 |
|result |`integer`         |是   |0    |   对应数值，不存在为0    |

### 获取物品基础属性
`getstditematt`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|itemid       |`integer`       |否   |    |   物品ID    |
|id       |`integer`       |否   |    |对应属性表的属性ID |
|result |`integer`         |是   |0    |   对应数值，不存在为0    |

 ```lua
function main(self)
    local item=linkbodyitem(self,0)
    if item then
        local itemid = getiteminfo(self,item,2)
        say(self, "关联物品0成功，唯一ID：" .. getiteminfo(self,item,1) .."\\物品名称："
        ..getstditeminfo(itemid,1)
        .."\\基础防御下限："..getstditematt(itemid,9)
        .."\\基础防御上限："..getstditematt(itemid,10)
        )
    else
        say(self, "关联物品0失败")
    end
end
```

### 获取当前唯一ID物品的星星数量
`getitemstars`
**&lt;font color="#ff0000"&gt;只支持脱下装备获取，不支持穿戴获取星星&lt;/font&gt;**

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemmakeid       |`integer`       |否   |    |   物品唯一ID    |

## 物品记录信息

### 获取-getitemaddvalue

`getitemaddvalue`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |   物品对象   |
|type     |`integer`       |否   |    |[1,2,3] |
|position     |`integer`       |否   |    |当type=1,取值范围[0..49] <br /> type=2,取值范围[0..19]|
|model     |`integer`       |否   |   引擎64_23.10.24新增 |当type=1,<br />0=附加属性;<br />1=基础属性+附加属性|
|result |`integer`         |是   |0    |   返回位置对应值    |

* type=1对应位置定义（范围：0~49）
   0.AC
   1.MAC
   2.DC
   3.MC
   4.SC
   5.幸运
   6.准确
   7.敏捷
   8.攻击速度
   9.魔法躲避
   10.毒物躲避
   11.体力恢复
   12.魔法恢复
   13.中毒恢复
   15.沙巴克武器升级标记
   16.强化的星数 
   17.失败的星数
   18.炼魂等级
   19.是否有自定义名称
   20.物理伤害减少
   21.魔法伤害减少
   22.忽视目标防御
   23.所有伤害反弹
   24.人物体力增加
   25.人物魔力增加
   26.增加目标爆率
   27.神       圣
   28.强       度
   29.诅       咒
   30.暴击率
   31.暴击伤害
   32.攻击伤害
   33.神秘戒指 神秘手镯 神秘头盔 三个装备是否被穿戴过 ==&gt; 在 祝福罐, 聚灵珠 这个位置表示是否重置 当前持久为 0
   34~39.宠物相关
   **40~44. 脚本使用**
   45.投保次数
   46.限时道具激活方式
   47~48.背包特效与装备内观特效
   49.拍卖行相关
* type=2对应位置定义（范围：0~19）
   0:用来记录剩余时间(秒)，到期后，自动销毁，只针对穿着装备/称号
   1:物品规则。1.禁止扔 2.禁止交易 4.禁止存 8.禁止修 16.禁止出售 32.禁止爆出 64.丢弃消失 128.死亡必爆 256.禁止拍卖 512.禁止挑战 1024.爆出消失;
   2:物品名字颜色
   3.装备升级次数或星星数量
   4~6.装备初始时，附带特殊属性（Word+Word）共6个
   7~17.引擎使用
   18.装备自定义属性标记 1代表有自定义属性
   19.装备标记，脚本使用，一共32个标记，位运算，注意使用转换成无符号的，当设定值=0，相当于清空所有标记。
* type=3对应位置定义（范围：0~31）
   **装备标记，脚本使用**，一共32个标记。设置时，只有识别2进制最低位有效，即设定值=5时，相当于设定值=1。
   例如：setitemaddvalue(self,item,3,1,5)，设定值=5，支取5的二进制最低位1，相当于setitemaddvalue(self,item,3,1,1)
* 如果物品对象获取失败，返回-1

### 设置-setitemaddvalue
`setitemaddvalue`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |   物品对象   |
|type     |`integer`       |否   |    |[1,2,3] |
|position     |`integer`       |否   |    |当type=1,取值范围[0..49] <br /> type=2,取值范围[0..19]|
|value |`integer`      |否   |    |   设置物品对应位置值    |

## 刷新物品信息到前端
`refreshitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象   |

```lua
function main(self)
    local item = linkbodyitem(self, 0)
    if item then
        local itemid = getiteminfo(self, item, 2)
        local str
        str = ""
        for i = 0, 49 do
            str = str .. "," .. getitemaddvalue(self, item, 1, i)
        end
        str = str .. "\\"
        for i = 0, 19 do
            str = str .. "," .. getitemaddvalue(self, item, 2, i)
        end
        say(self, str);
        setitemaddvalue(self, item, 1, 1, math.random(100));
        refreshitem(self, item);
        recalcabilitys(self)
    else
        say(self, "关联物品0失败")
    end
end
```
## 自定义属性
### 获取-getitemcustomabil
`getitemcustomabil`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象   |
|result |`string`      |是   |0    |   Json字符串，自定义属性内容，如果获取物品对象失败，则返回空字符串    |

### 清理物品自定义属性-clearitemcustomabil
`clearitemcustomabil`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象   |
|group  |`integer`         |否   |0    | 组别，-1：所有组，0~5：对应组别  |

### 设置-setitemcustomabil
`setitemcustomabil`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象   |
|value  |`string`      |是   |0    |   Json字符串，自定义属性内容    |

- Json内容参考
```json
{"abil":[{"i":0,"t":"[锻造属性]","c":251,"v":[[0,3,1,0,1,0,1],[0,4,1,0,1,0,2],[0,5,1,0,9,2,3],[0,6,1,0,9,2,4],[0,7,1,0,10,3,5],[0,8,1,0,10,3,6],[0,25,0,1,2,4,7]]}],"name":""}
```
- 示例
```lua
            local tbl = {
                ["abil"] = {
                    {
                        ["i"] = 0,
                        ["t"] = "[星级测试]\\&lt;IMG:3&gt;\\星级:3",
                        ["c"] = 251,
                        ["v"] = {
                            {0,3,1,0,1,0,1},
                            {0,4,1,0,1,0,2},
                            {0,5,1,0,9,2,3},
                            {0,6,1,0,9,2,4},
                            {0,6,1,0,9,2,4},
                            {0,7,1,0,10,3,5},
                            {0,8,1,0,10,3,6},
                            {0,25,0,1,2,4,7},
                        },
                    },
                },
                ["name"] = itemName .. "[锻造 + 1]",
            }
            setitemcustomabil(actor,itemobj,tbl2json(tbl))
            refreshitem(actor,itemobj)
```

| 参数   | 类型   | 描述                                            |
| :----- | :----- | :---------------------------------------------- |
| - abil | object | 自定义属性（0~5）                               |
| i      | number | 索引                                            |
| t      | string | 标题名                                          |
| c      | number | 颜色                                            |
| - - v  | object | 属性条目                                        |
| 1      | number | 颜色                                            |
| 2      | number | 属性ID                                          |
| 3      | number | 属性值                                          |
| 4      | number | 类型 0 数值  1 百分比                           |
| 5      | number | 显示自定义类名称(cfg_custpro_caption表里面的ID) |
| 6      | number | 所在行                                          |
| 7      | number | 索引                                            |
| name   | string | 自定义物品名                                    |

### 绑定自定义装备属性
`changecustomitemabil`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象   |
|attrindex  |`integer`         |是   |0    |  属性位置(0~9)每个装备可以自定义10个属性    |
|bindindex  |`integer`         |是   |0    |  绑定类型(0~4)  |
|bindvalue  |`integer`         |是   |0    |  绑定的值    |
|group  |`integer`         |是   |0    |  显示分类位置<br />(0~5 ;为空默认为0)    |

```
    绑定类型(0~4):
    0=标识该属性绑定的颜色值默认读取(属性表:cfg_custpro_caption.xls)里面的颜色
    1=表示该绑定属性表(属性ID:cfg_att_score.xls的属性ID),必须绑定，否则该属性无效，游戏也不会显示
    2=标示该属性绑定自定义属性表:cfg_custpro_caption.xls里面的属性ID
    3=表示该属性是否是百分比属性(0,1) 0不是百分比 1是百分比
    4=属性显示位置(0~9) 如果一行有多个属性,这里位置就写同一行
    
    绑定的值:
    参数4(绑定类型)=0时 绑定属性颜色(0~255) 默认读取(属性表:cfg_custpro_caption.xls)里面的颜色
    参数4(绑定类型)=1时 绑定属性表:cfg_att_score.xls里面的属性ID
    参数4(绑定类型)=2时 绑定自定义属性表:cfg_custpro_caption.xls里面的属性ID
    参数4(绑定类型)=3时 绑定的值(0~1)
    参数4(绑定类型)=4时 显示位置(0~9)
```
```lua
    local itemobj = linkbodyitem(actor,1)
    local itemidx = getiteminfo(actor,itemobj,2)
    local itemName = getstditeminfo(itemidx,1)
    local weizhi = 0
    local attrIndex = 4
    local attrValue = 100
    release_print(itemName,"修改属性",attrIndex .."+" .. attrValue)
    changecustomitemtext(actor, itemobj, "[自定义属性测试]：", 0)
    changecustomitemtextcolor(actor, itemobj, 253, 0)
    changecustomitemabil(actor,itemobj,weizhi,0,214,0)
    changecustomitemabil(actor,itemobj,weizhi,1,attrIndex,0)
    -- changecustomitemabil(actor,itemobj,weizhi,2,1,0)
    -- changecustomitemabil(actor,itemobj,weizhi,3,0,0)
    changecustomitemabil(actor,itemobj,weizhi,4,weizhi,0)
    changecustomitemvalue(actor,itemobj,weizhi,"+",attrValue,0)
    refreshitem(actor,itemobj)
```

### 修改自定义属性值
`changecustomitemvalue`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象   |
|attrindex  |`integer`         |是   |0    |  属性位置(0~9)每个装备可以自定义10个属性    |
|operate  |`string`        |是   |    |  操作符：+、-、=  |
|value  |`integer`         |是   |0    |  属性值    |
|group  |`integer`         |是   |0    |  显示分类位置<br />(0~5 ;为空默认为0)    |

### 增加和修改自定义属性分类名称
`changecustomitemtext`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象   |
|typename  |`string`       |是   |0    |  分类名称(-1为清空)      |
|group  |`integer`         |是   |0    |  显示分类位置<br />(0~5 ;为空默认为0)    |

### 增加和修改分类名称颜色
`changecustomitemtextcolor`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象   |
|color  |`integer`         |是   |0    |  分类颜色(0~255)    |
|group  |`integer`         |是   |0    |  显示分类位置<br />(0~5 ;为空默认为0)    |

### 将物品唯一ID转换成道具表里对应的IDX物品
`changeitemidx`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemmakeid       |`integer`       |否   |    |  唯一ID   |
|itemidx  |`integer`       |否   |    |  道具ID    |

### 增加限次使用物品的次数
`addfunitemdura`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemmakeid       |`integer`       |否   |    |  唯一ID   |
|num  |`integer`       |否   |    |  次数    |

### 获取物品持久度
`getdura`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemmakeid       |`integer`       |否   |    |  唯一ID   |
|result       |`integer`        |否   |    |  持久度  |

### 修改物品持久度
`setdura`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemmakeid       |`integer`       |否   |    |  唯一ID   |
|char  |`string`      |否   |    |  操作符(+ - =)    |
|dura  |`integer`      |否   |    |  持久度    |
```lua
    setdura(actor,itemmakeid,"=",1000)
```

### 修改装备内观Looks值

`setitemlooks`

| 参数    | 类型      | 空   | 默认                | 注释                     |
| :------ | :-------- | :--- | :------------------ | :----------------------- |
| play    | `object`  | 否   |                     | 玩家对象                 |
| itemPos | `integer` | 否   |                     | 装备位置(-2操作物品对象) |
| char    | `string`  | 否   |                     | 操作符(+ - =)            |
| pictrue | `integer` | 否   |                     | 内观图片                 |
| item    | `object`  | 否   | 引擎64_23.08.30新增 | 物品对象                 |
```lua
--根据装备位设置内观Looks值
setitemlooks(actor,1,"=",85)

--根据装备对象设置内观Looks值
setitemlooks(actor,-2,"=",85,itemobj)
```

### 设置物品来源
`setthrowitemly`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|source     |`string`      |否   |    |   json字符串 |
```
source格式
{
    map: "0", //地图号
    source: 5,  //来源：1-GM生成，2-NPC，3-商城，4-NPC商店, 5-怪物掉落，6-系统给与，7-挖矿，8-批量生成，9-宝箱
    mon:"白野猪",  //掉落的怪物
    player:"玩家人物名称",  
    time:"2021-11-11 00:00:00"  //掉落或生成的时间，为空时，设置为系统时间
}
设置来源接口调用后，会将生成的来源数据保存到后端，脚本中给与物品时，会自动绑定。
```

### 设置物品来源（使用物品对象）
`setthrowitemly2`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象  |
|source     |`string`      |否   |    |   json字符串 |
```
source格式同setthrowitemly
```

### 获取物品来源（使用物品对象）
`getthrowitemly`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  物品对象  |
|result     |`string`      |否   |    |   json字符串 |
```
source格式同setthrowitemly
```

------------
## 刀魂系统

### 设置自定义进度条参数
`setcustomitemprogressbar`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  装备对象   |
|index  |`integer`         |否   |    |   装备精度条索引（0~2）    |
|json  |`string`       |否   |    |   进度条内容，json字符串    |
```lua
    [[
        // json格式，json中各项参数均可以为空：
        {
            open:1,  //0-关闭，1-打开
            show:1,  //0-不显示数值，1-百分比，2-数字
            name:"锻造",  //进度条文本
            color:3,  //进度条颜色，0~255
            imgcount:1,  //图片张数，填1即可
            cur:0,  //当前值
            max:100,  //最大值
            level:0  //级别(0~65535)
        }
    ]]
    local itemobj = linkbodyitem(actor,1)
    local tbl = {
        ["open"] = 1,
        ["show"] = 2,
        ["name"] = "经验值",
        ["color"] = 253,
        ["imgcount"] = 1,
        ["cur"] = 2500,
        ["max"] = 5000,
        ["level"] = 0,
    }
    setcustomitemprogressbar(actor,itemobj,0,tbl2json(tbl))
    refreshitem(actor,itemobj)
```

### 获取自定义进度条参数
`getcustomitemprogressbar`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  装备对象   |
|index  |`integer`         |否   |    |   装备精度条索引（0~2）    |
|result  |`string`         |否   |    |   进度条内容，json字符串    |

------------

### 装备批量增加附加属性

`setaddnewabil`

| 参数    | 类型      | 空   | 默认 | 注释                     |
| :------ | :-------- | :--- | :--- | :----------------------- |
| play    | `object`  | 否   |      | 玩家对象                 |
| where   | `integer` | 否   |      | 装备位置(-2操作物品对象) |
| opt     | `string`  | 否   |      | 运算符(+,-,=)            |
| attrStr | `string`  | 否   |      | 属性组                   |
| item    | `object`  | 否   |      | 物品对象                 |
```lua
--根据装备位加属性
setaddnewabil(actor,1,"+","3#3#2|3#4#10|3#4#2|3#5#10|3#23#2|3#74#10")

--根据物品对象加属性
setaddnewabil(actor,-2,"+","3#3#2|3#4#10|3#4#2|3#5#10|3#23#2|3#74#10",itemobj)
```

### 获取人物身上装备属性值命令

`getitemattidvalue`

| 参数   | 类型      | 空   | 默认 | 注释                                  |
| :----- | :-------- | :--- | :--- | :------------------------------------ |
| play   | `object`  | 否   |      | 玩家对象                              |
| model  | `integer` | 否   |      | 类型(1，装备表里基础数据 2，附加属性) |
| attrID | `integer` | 否   |      | 属性ID                                |
| where  | `integer` | 否   |      | 装备位置(-2操作物品对象)              |
| item   | `object`  | 否   |      | 物品对象                              |
```lua
--根据装备位获取属性
local attr_str = getitemattidvalue(actor,2,4,1)

--根据物品对象获取属性
local attr_str = getitemattidvalue(actor,2,4,-2,itemobj)
```

------------

## 宝石相关
### 装备开孔
`drillhole`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  装备对象   |
|holejson  |`string`       |否   |    |  开孔相关，json字符串，支持0~9共10个孔    |
```lua
    local config = {}
    for i = 0, 9 do
        config["hole"..i] = 1 -- 0-不开孔，1-开孔
    end
    drillhole(actor,itemobj,tbl2json(config))
    release_print("开孔信息1",getdrillhole(actor,itemobj))

    -- * 不要求所有空数据都传送，允许只传指定孔的字符串，例如：
    local config = {}
    config.hole0 = 1 -- 0-不开孔，1-开孔
    drillhole(actor,itemobj,tbl2json(config))
    release_print("开孔信息2",getdrillhole(actor,itemobj))
```

### 获取装备开孔数据
`getdrillhole`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  装备对象   |
|result   |`string`        |否   |    |  开孔相关，json字符串，支持0~9共10个孔    |
```
返回的json字符串参考装备开孔
```

### 装备镶嵌钻石
`socketableitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  装备对象   |
|hole     |`integer`       |否   |    |  装备开孔序号，0~9   |
|item     |`integer`       |否   |    |  镶嵌钻石的index（装备表总的Index）   |

### 获取装备钻石镶嵌情况
`getsocketableitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|item     |`object`        |否   |    |  装备对象   |
|result   |`string`        |否   |    |  开孔相关，json字符串，支持0~9共10个孔    |
```json
socketableitem 镶嵌宝石，传入json
getsocketableitem 返回镶嵌宝石的json
{
    socket0: 20333,  //第0个孔位置，20333-对应宝石的Index，
    socket1: 0,  //第1个孔位置，0-未镶嵌宝石
    socket2: 0,
    socket3: -1,  //第3个孔位置，-1-未打孔
    socket4: -1,
    socket5: -1,
    socket6: 0,
    socket7: -1,
    socket8: -1,
    socket9: -1
}

```
### 设置物品特效

`setitemeffect`

| 参数        | 类型      | 空   | 默认                | 注释                      |
| :---------- | :-------- | :--- | :------------------ | :------------------------ |
| play        | `object`  | 否   |                     | 玩家对象                  |
| itemPos     | `integer` | 否   |                     | 装备位置(-2操作物品对象)  |
| bageffectid | `integer` | 否   |                     | 背包特效编号              |
| ineffectid  | `integer` | 否   |                     | 内观特效编号              |
| order1      | `integer` | 否   |                     | 背包特效层级<br />0=前;1=后 |
| order2      | `integer` | 否   |                     | 内观特效层级<br />0=前;1=后 |
| item        | `object`  | 否   | 引擎64_23.08.30新增 | 物品对象                  |
```lua
--根据装备位设置特效
setitemeffect(actor,1,5111,6063,1,1)

--根据物品对象设置特效
setitemeffect(actor,-2,6307,6063,nil,nil,itemobj)
```

------------

## 根据物品获取Json

`getitemjson`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|item     |`object`      |否   |    |  物品对象 |
|result     |`string`        |否   |    |  json字符串   |

```json
{
    "MakeIndex":xxxx,
    "Idx":xxxx,
    "Name":xxxx,
    "Dura":xxxx,
    "DuraMax":xxxx,
    "Overlap":xxxx,
    "AddValue0":xxxx,
    "AddValue1":xxxx,
    "ExAbil":xxxx
}
```
```lua
    local json = getitemjson(item)
```

## 根据json字符串给物品
`giveitembyjson`

| 参数   | 类型     | 空   | 默认                | 注释           |
| :----- | :------- | :--- | :------------------ | :------------- |
| actor  | `object` | 否   |                     | 玩家对象       |
| json   | `string` | 否   |                     | json字符串     |
| desc   | `string` | 是   | 引擎64_24.05.23新增 | 描述           |
| result | `object` | 否   |                     | 生成的物品对象 |

```json
{
    "MakeIndex":xxxx,
    "Idx":xxxx,
    "Name":xxxx,
    "Dura":xxxx,
    "DuraMax":xxxx,
    "Overlap":xxxx,
    "AddValue0":xxxx,
    "AddValue1":xxxx,
    "ExAbil":xxxx
}
*注 : 根据json字符串给的物品，将会生成新的MakeIndex
```

## 根据物品获取前端显示的Json

`getitemjsonex`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_23.12.07新增接口&lt;/font&gt;**

| 参数   | 类型     | 空   | 默认 | 注释       |
| :----- | :------- | :--- | :--- | :--------- |
| item   | `object` | 否   |      | 物品对象   |
| result | `string` | 否   |      | json字符串 |
```lua
function main(actor)
    local itemobj = linkbodyitem(actor,1)
    local itemjson = getitemjsonex(itemobj)
    str = [[&lt;ItemShow|x=0.0|y=0.0|width=70|height=70|itemdata=]]..itemjson..[[|showtips=1|bgtype=1|color=250&gt;]]
    say(actor,itemobj)
end
```

------------

### 关闭指定装备对比提示
`nothintitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|actor     |`object`      |否   |    |  玩家对象 |
|order     |`integer`      |否   |    |  1=物品唯一ID 2=物品IDX 3=物品名称 |
|str      |`string`        |否   |    |  参数1的值   |
```
    nothintitem(actor,3,"木剑")
```

### 设置物品绑定状态

`setitemstate`

| 参数  | 类型      | 空   | 默认 | 注释                           |
| :---- | :-------- | :--- | :--- | :----------------------------- |
| item  | `object`  | 否   |      | 物品对象                       |
| bind  | `integer` | 否   |      | 绑定类型(0-8,21)               |
| state | `integer` | 否   |      | 绑定状态<br />0=不绑定<br />1=绑定 |
```lua
local config = {
    [0] = "禁止扔",
    [1] = "禁止交易",
    [2] = "禁止存",
    [3] = "禁止修",
    [4] = "禁止出售",
    [5] = "禁止爆出",
    [6] = "丢弃消失",
    [7] = "死亡必爆(死亡爆出来后，该属性就会删除，在捡起来戴上，就没有死亡必爆了)",
    [8] = "禁止摆摊或上架拍卖行",
    [21] = "爆出消失[引擎64_24.03.14新增]",
}
-- 捡取任意物品前触发
function pickupitemfrontex(actor, itemobj)
    for i, v in pairs(config) do
        setitemstate(itemobj,i,1)
        local state1 = getiteminfo(actor,itemobj,6)
        local state2 = checkitemstate(itemobj,i)
        release_print("状态:",i,v,state1,state2)
    end
end
```

### 判断绑定状态
`checkitemstate`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_23.12.07新增接口&lt;/font&gt;**

| 参数   | 类型      | 空   | 默认 | 注释                           |
| :----- | :-------- | :--- | :--- | :----------------------------- |
| item   | `object`  | 否   |      | 物品对象                       |
| bind   | `integer` | 否   |      | 绑定类型(0-8,21)               |
| result | `bool`    | 否   |      | true = 绑定<br /> false = 非绑定 |

### 判定物品是否极品

`isitemjp`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|item     |`object`      |否   |    |  物品对象 |
|result     |`bool`      |否   |    | true = 是极品<br /> false = 不是极品 |

### 判断角色是否有该物品
`hasitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|actor     |`object`      |否   |    |  玩家对象 |
|itemMakeIndex     |`object`      |否   |    |  物品唯一id |
|result     |`integer`      |否   |    |返回值<br /> 0-装备，1-背包<br />2-仓库, -1-不存在 |

### 设置装备的元素属性

`setnewitemvalue`

| 参数    | 类型      | 空   | 默认                | 注释                     |
| :------ | :-------- | :--- | :------------------ | :----------------------- |
| play    | `object`  | 否   |                     | 玩家对象                 |
| itemPos | `integer` | 否   |                     | 装备位置(-2操作物品对象) |
| iAttr   | `integer` | 否   |                     | 属性                     |
| sFlag   | `string`  | 否   |                     | 比较符(=+-)              |
| iValue  | `integer` | 否   |                     | 数值(1-100)，百分比      |
| item    | `object`  | 否   | 引擎64_23.08.30新增 | 物品对象                 |
```lua
--根据装备位设置元素属性
setnewitemvalue(actor,1,1,"+",1)

--根据物品对象设置元素属性
setnewitemvalue(actor,-2,1,"+",100,itemobj)
```

### 获取物品的附加属性
`getnewitemaddvalue`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|itemobj     |`object`      |否   |    |  物品对象 |
|value    |`integer`       |否   |    |  元素属性<br /> 0:暴击几率<br /> 1攻击伤害<br /> 2:物理伤害减少<br /> 3:魔法伤害减少<br /> 4:忽视目标防御<br /> 5:所有伤害反弹<br /> 6:目标爆率<br /> 7:人物体力增加<br /> 8:人物魔力增加<br /> 11:暴击伤害<br />    |

### 修复所有装备
`repairall`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |  玩家对象 |

```lua
    [[
        需要在npc脚本中使用,且文件头需设置itemstype表储存需要修复的装备位置
        Mir200\Envir\Market_Def\第一大陆\装备修复-3.lua
    ]]
    itemstype = {1,2,3,4,5,6,7,8,9,10}
    function main(actor)
        local msg =[[&lt;设置持久/@chijiu&gt;\&lt;一键修复/@xiufu&gt;]]
        say(actor,msg)
    end
    function chijiu(actor)
        local itemobj = linkbodyitem(actor,1)
        local itemMakeId = getiteminfo(actor,itemobj,1)
        setdura(actor,itemMakeId,"=",2000)
    end
    function xiufu(actor)
        repairall(actor)
    end
```

### 调整人物身上物品装备名字颜色
`changeitemnamecolor`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|item     |`object`        |否   |    |  物品对象   |
|color     |`integer`      |否   |    |颜色(0-255)颜色=0时恢复默认颜色 |

### 检测装备名字的颜色
`getitemnamecolor`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|item     |`object`        |否   |    |  物品对象   |
|result |`integer`         |是   |0    |   返回颜色值    |

### 修改物品/装备名称

`changeitemname`

| 参数     | 类型      | 空   | 默认                | 注释                     |
| :------- | :-------- | :--- | :------------------ | :----------------------- |
| play     | `object`  | 否   |                     | 玩家对象                 |
| itemPos  | `integer` | 否   |                     | 装备位置(-2操作物品对象) |
| itemName | `string`  | 否   |                     | 装备名字                 |
| item     | `object`  | 否   | 引擎64_23.08.30新增 | 物品对象                 |
```lua
--根据装备位改名
changeitemname(actor,1,"装备改名1")

--根据物品对象改名
changeitemname(actor,-2,"装备改名2",itemobj)

--怪物物品掉落回调接口
function mondropitemex(actor, itemobj, monobj, x, y)
    [[引擎64_23.10.24支持刷新地面物品的名字,之前引擎需要调用TXT命令]]
    changeitemname(actor,-2,"测试道具_lua22",itemobj)
    changeitemnamecolor(actor,itemobj,199)
    refreshitem(actor,itemobj)
    
    [[之前的引擎需要调用TXT命令]]
    -- callscriptex(actor,"LINKPICKUPITEM")
    -- callscriptex(actor,"ChangeItemName",-1,"测试道具_txt2")
    -- callscriptex(actor,"changeitemnamecolor",-1,200)
    -- callscriptex(actor,"SENDUPGRADEITEM")
end
```

### 获取物品原始各项数据库字段值参数

`getdbitemfieldvalue`

| 参数             | 类型               | 空   | 默认 | 注释            |
| :--------------- | :----------------- | :--- | :--- | :-------------- |
| itemIdx/itemName | `integer`/`string` | 否   |      | 物品ID/物品名称 |
| fieldName        | `string`           | 否   |      | 字段名          |

```lua
    local config = {
        {"Name", "1列"},
        {"StdMode", "2列"},
        {"Shape", "3列"},
        {"Weight", "4列"},
        {"Anicount", "5列"},
        {"Source", "6列"},
        -- {"Reserved", "7列"},      --接口无法获取,服务器不读取
        {"Looks", "8列"},
        {"DuraMax", "9列"},
        {"Attribute", "10列"},
        {"Need", "11列"},
        {"NeedLevel", "12列"},
        {"NeedLevelParam", "12列","NeedLevel#后的数据"},
        {"Price", "13列"},
        {"Color", "14列"},
        {"OverLap", "15列"},        --装备无法获取堆叠数量,固定返回值为0
        -- {"Suit", "16列"},        --当前引擎已取消16列
        {"Article", "17列"},
        {"Job", "18列"},
        {"effectParam", "19列"},
        -- {"Desc", "20列"},        --接口无法获取,服务器不读取
        -- {"pickset", "21列"},     --接口无法获取,服务器不读取
        -- {"guangzhu", "22列"},    --接口无法获取,服务器不读取
        -- {"auctionby", "23列"},   --接口无法获取,服务器不读取
        {"sEffect", "24列"},
        {"bEffect", "25列"},
        {"rizhi", "27列"},          --引擎2024.03.14修复无法获取问题
        {"zblmtkz", "28列"},        --引擎2024.03.14修复无法获取问题
        {"ITEMPAEAM1", "29列"},
        {"ITEMPAEAM2", "30列"},
        -- {"Comparison", "31列"},  --接口无法获取,服务器不读取
        {"suit", "32列"},           --32列的suitid更名为suit
        {"Insurance", "33列"},
        -- {"pickCondition", "34列"},--接口无法获取,服务器不读取
    }
    for _, v in ipairs(config) do
        release_print("对应item/equip表",v[2],v[1]..(v[3] or ""),getdbitemfieldvalue("20000元宝", v[1]))
    end
```

### 获取背包物品数量

`getbagitemcount`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|itemname     |`string`      |否   |    |  物品名称 |
|model     |`string`      |否   |  引擎64_23.10.24新增  | 物品绑定状态<br />0=忽略;<br />1=非绑定;<br />2=绑定; |
|result     |`integer`      |否   |    |   返回值，对应物品的数量 |
```lua
    local itemNum = getbagitemcount(actor,"木剑")
    release_print("itemNum",itemNum)
```

## 根据索引返回背包物品信息

&gt; 删物品需判断是否成功

`getiteminfobyindex`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|index    |`integer`       |否   |    |    索引号,0开始   |
|result       |`object`        |否   |    |  物品对象  |

### 整理背包里的物品

`refreshbag`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |

### 获取仓库所有物品

`getstorageitems`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |   玩家对象 |
|result     |`table`      |否   |    |   物品对象列表 |

### 获取背包物品列表

`getbagitems`

| 参数     | 类型      | 空   | 默认                | 注释                                     |
| :------- | :-------- | :--- | :------------------ | :--------------------------------------- |
| player   | `object`  | 否   |                     | 玩家对象                                 |
| itemName | `string`  | 否   | 引擎64_23.10.24新增 | 道具名字                                 |
| isbind   | `integer` | 否   | 引擎64_23.10.24新增 | 是否绑定<br />0=忽略<br />1=非绑定<br />2=绑定 |
| result   | `table`   | 是   |                     | 道具列表                                 |
```lua
    local items
    if sMsg == "1" then
        release_print("获取背包所有物品")
        items = getbagitems(actor)
    elseif sMsg == "2" then
        release_print("获取背包所有非绑定物品")
        items = getbagitems(actor,nil,1)
    elseif sMsg == "3" then
        release_print("获取背包所有绑定物品")
        items = getbagitems(actor,nil,2)
    elseif sMsg == "4" then
        release_print("获取背包非绑定木剑")
        items = getbagitems(actor,"木剑",1)
    elseif sMsg == "5" then
        release_print("获取背包绑定木剑")
        items = getbagitems(actor,"木剑",2)
    elseif sMsg == "6" then
        release_print("获取背包所有木剑")
        items = getbagitems(actor,"木剑")
    end
    if type(items) ~= "table" then return end
    for i, itemobj in pairs(items or {}) do
        local isBind = getiteminfo(actor,itemobj,6)
        local itemName = getiteminfo(actor,itemobj,7)
        release_print("item["..i.."]",itemName,isbind)
    end
```

------------

### 从装备位扣除物品

`delbodyitem`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_23.10.24新增接口&lt;/font&gt;**

| 参数   | 类型      | 空   | 默认                | 注释                            |
| :----- | :-------- | :--- | :------------------ | :------------------------------ |
| player | `object`  | 否   |                     | 玩家对象                        |
| where  | `integer` | 否   |                     | 装备位                          |
| desc   | `string`  | 是   | 引擎64_24.05.23新增 | 描述                            |
| result | `bool`    | 是   |                     | true=扣除成功<br />false=扣除失败 |

### 根据StdMode获取装备位

`getposbystdmode`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_23.10.24新增接口&lt;/font&gt;**

| 参数    | 类型      | 空   | 默认 | 注释        |
| :------ | :-------- | :--- | :--- | :---------- |
| stdMode | `integer` | 否   |      | 道具StdMode |
| result  | `integer` | 是   |      | 装备位      |

### 批量检测背包物品

`checkitems`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_24.03.14新增接口&lt;/font&gt;**

| 参数    | 类型      | 空   | 默认 | 注释                                                        |
| :------ | :-------- | :--- | :--- | :---------------------------------------------------------- |
| play    | `object`  | 否   |      | 玩家对象                                                    |
| itemStr | `string`  | 否   |      | 物品名称#物品数量&amp;物品名称#物品数量 (&amp;=和的意思)            |
| isBind  | `integer` | 否   |      | 0=不检测;<br /> 1.非绑定<br />2.绑定                            |
| model   | `integer` | 否   |      | 参数2中的物品名称是ID还是道具名称<br />0=道具名称<br />1=道具ID |
| result  | `bool`    | 否   |      | 是否满足条件                                                |
```lua
    local item_str = "屠龙#3&amp;木剑#4"
    if checkitems(actor,item_str ,0 ,0) then
        local bool = takes(actor,item_str,0,0)
        LOGPrint("是否扣除成功,takes",bool)
    end
```

### 批量拿走背包物品

`takes`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_24.03.14新增接口&lt;/font&gt;**

| 参数    | 类型      | 空   | 默认                | 注释                                                         |
| :------ | :-------- | :--- | :------------------ | :----------------------------------------------------------- |
| play    | `object`  | 否   |                     | 玩家对象                                                     |
| itemStr | `string`  | 否   |                     | 物品#物品数量&amp;物品#物品数量 (&amp;=和的意思)                     |
| varName | `string`  | 否   |                     | 存入变量名,判断扣除道具中是否有绑定的<br />0=非绑定<br /> 1=绑定 |
| model   | `integer` | 否   |                     | 参数2中的传入的物品代表名称还是ID<br />0=道具名称<br />1=道具ID  |
| order   | `integer` | 否   |                     | 0=按照默认顺序<br />1=优先扣除绑定道具                         |
| desc    | `string`  | 是   | 引擎64_24.05.23新增 | 描述                                                         |
| result  | `bool`    | 否   |                     | 是否扣除成功                                                 |

```lua
    local varName = "N0"
    local bool = takes(actor,item_str,varName,0,0,"GM删物品")
    release_print("takes是否扣除成功:",bool)
    release_print("判断扣除道具中是否有绑定",getplaydef(actor, varName))
```

### 扣除角色穿戴的装备

`takew`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_24.03.14新增接口&lt;/font&gt;**

| 参数     | 类型      | 空   | 默认                | 注释                                                                            |
| :------- | :-------- | :--- | :------------------ | :------------------------------------------------------------------------------ |
| play     | `object`  | 否   |                     | 玩家对象                                                                        |
| itemName | `string`  | 否   |                     | 装备名称                                                                        |
| num      | `integer` | 否   |                     | 扣除物品数量                                                                    |
| desc     | `string`  | 是   | 引擎64_24.05.23新增 | 描述                                                                            |
| result   | `bool`    | 否   |                     | 是否扣除成功<br />传入数量大于1时返回值不准确<br />使用前注意先判断是否满足扣除条件 |
```lua
    local bool = takew(actor,"力量戒指",2)
    LOGPrint("是否扣除成功,takew",bool)
```

### 批量给予物品

`gives`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_24.05.23新增接口&lt;/font&gt;**

| 参数    | 类型     | 空   | 默认 | 注释                                                      |
| :------ | :------- | :--- | :--- | :-------------------------------------------------------- |
| actor   | `object` | 否   |      | 玩家对象                                                  |
| itemStr | `string` | 否   |      | 物品参数<br />物品名称#数量#绑定状态&amp;物品名称#数量#绑定状态 |
| desc    | `string` | 否   |      | 描述                                                      |
```lua
    local itemStr = "木剑#1#128&amp;开天#1"
    gives(actor,itemStr,"[gives]刷物品测试")
```

### 检测身上佩戴的装备

`checkitemw`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_24.05.23新增接口&lt;/font&gt;**

| 参数      | 类型      | 空   | 默认 | 注释     |
| :-------- | :-------- | :--- | :--- | :------- |
| actor     | `object`  | 否   |      | 玩家对象 |
| item_name | `string`  | 否   |      | 装备名称 |
| item_num  | `integer` | 是   | 1    | 检测数量 |
| result    | `bool`    | 否   |      | 是否穿戴 |
```lua
    if not checkitemw(actor,"金手镯",2) then
        say(actor,"请先佩戴两个金手镯~")
        return
    end
```

### 返回前端面板消息[合成系统]

`sendactionofjson`

&gt; **&lt;font color="#808080" style="font-size: 13px;"&gt;引擎64_24.05.23新增接口&lt;/font&gt;**

| 参数  | 类型     | 空   | 默认 | 注释      |
| :---- | :------- | :--- | :--- | :-------- |
| actor | `object` | 否   |      | 玩家对象  |
| idx   | `string` | 否   |      | 合成表idx |
| json  | `string` | 否   |      | json信息  |
```lua
function g_compounditem10000(actor,idx)
    local data_json = string.format('{"action":"event","data":{"recog":%s,"param1":%s}}',"-2",idx)
    sendactionofjson(actor,idx,data_json)
end
```