###### 更新时间：引擎64_23.03.23


## 宠物说明
```
1.支持宠物蛋生成宠物， 宠物蛋类别是StdMode=201，Anicount字段填对应怪物表里宠物的IDX
2.cfg_petlevel.xls为宠物等级表，配置宠物经验和不同等级宠物属性
2.支持宠物变成道具宠物蛋
3.宠物穿戴装备只支持装备表里的装备，自定义属性 套装等装备不支持，宠物没有装备格子，可以用命令可以获取宠物身上装备清单，显示到面板
4.宠物序号重0开始，删除一个序号的宠物，后面的序号自动补齐上一个序号。比如0-4，共5个宠物，删除3号宠物，4号宠物序号就变成3了
5.召唤宠物方式1：1双击宠物蛋获得宠物功能，然后执行RECALLPET命令召唤出来宠物，宠物死亡后需要用复活命令复活，复活后再用RECALLPET命令召唤
  召唤宠物方式2：无需宠物蛋CREATEPET命令直接得宠物功能，然后执行RECALLPET命令召唤出来宠物，宠物死亡后需要用复活命令复活，复活后再用RECALLPET命令召唤
6.宠物目前不支持跨服

【宠物相关M2设置】：
  M2-宠物设置-开启宠物系统

【宠物相关表格设置】：
【cfg_monster.xls怪物表】      （宠物race类型必须是156 19，怪物表Custommonster字段必现填至少一种攻击形式）
表格范例：
1459 小狐狸 156 19 320 80 1 100 3000 3#1#1000|3#3#500|3#4#500 60 45 700 1 0 800  7 11

【cfg_petlevel.xls宠物等级表】
表格范例：
1 1459 小狐狸 1 100 1#100|3#10  21 90 500 500

【cfg_monattack.xls自定义怪物表】
 表格范例：                       11 20011 30#100#100 0 1 0 0 1 0 100#500 0 1#100#5#100|2#100#1#300
```

## 触发
### 宠物升级触发
`petlevelup`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|petIdx     |`integer`      |否   |    |宠物编号 |
|level     |`integer`      |否   |    |等级 |
|zslevel     |`integer`      |否   |    |转生等级 |

### 获得宠物触发[人物上线首次加载宠物时也会触发]
`getnewpet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|petIdx     |`integer`      |否   |    |宠物编号 |

### 使用宠物蛋触发
`usepetitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|makeIndex     |`integer`      |否   |    |物品唯一id |
|itenIdx     |`integer`      |否   |    |物品id |

### 宠物死亡触发
`petdie`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|petIdx     |`integer`      |否   |    |宠物编号 |

### 宠物变蛋触发
`pettoitem`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|makeIndex     |`integer`      |否   |    |物品唯一id |

### 宠物攻击触发
`attackbypet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|petIdx     |`integer`      |否   |    |宠物编号 |
|target     |`object`      |否   |    |目标对象 |
|magicID     |`integer`      |否   |    |技能id |
|isImportant     |`integer`      |否   |    |是否主目标 |

### 宠物攻击伤害前触发
`attackdamagepet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|target     |`object`      |否   |    |目标对象 |
|petObj     |`object`      |否   |    |宠物对象 |
|magicID     |`integer`      |否   |    |技能id |
|damage     |`integer`      |否   |    |伤害值 |
|isImportant     |`integer`      |否   |    |是否主目标 |
|result       |`integer`       |否   |    |   返回值<br>修改后的伤害 |

### 宠物被攻击前触发
`struckdamagepet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|hiter     |`object`      |否   |    |攻击者对象 |
|petIdx     |`object`      |否   |    |宠物编号 |
|magicID     |`integer`      |否   |    |技能id |
|damage     |`integer`      |否   |    |伤害值 |
|result       |`integer`       |否   |    |   返回值<br>修改后的伤害 |

### 宠物被物理攻击触发
`struckofpet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|petIdx     |`object`      |否   |    |宠物编号 |
|hiter     |`object`      |否   |    |攻击者对象 |
|magicID     |`integer`      |否   |    |技能id |

### 宠物被魔法攻击触发
`magicstruckofpet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`      |否   |    |玩家对象 |
|petIdx     |`object`      |否   |    |宠物编号 |
|hiter     |`object`      |否   |    |攻击者对象 |
|magicID     |`integer`      |否   |    |技能id |

## 接口

### 获取宠物
`getpet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|idx     |`integer`    |否   |    |   宠物序号或'X'表示当前宠物 |
|result     |`object`      |否   |    |   返回宠物对象 |

### 获取宠物蛋信息
`getpetegglevel`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|itemmakeid     |`integer`    |否   |    |   物品MakeIndex |
|type     |`integer`    |否   |    |   需要返回的数值<br>1-转生等级;<br>2-等级;<br>3-经验;<br>0-同时返回三个值|

### 设置宠物蛋等级
`setpetegglevel`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|itemmakeid     |`integer`    |否   |    |   物品MakeIndex |
|level     |`integer`    |否   |    |   等级，-1表示不修改值|
|zlevel     |`integer`    |否   |    |   转生等级，-1表示不修改值|
|exp     |`integer`    |否   |    |   经验值，-1表示不修改值|

### 创建宠物

`createpet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|monname     |`string`      |否   |    |自定义怪物名称 |
|level     |`integer`      |否   |    |   怪物等级 |

### 召唤宠物
`recallpet`

> 召唤idx号宠物，如宠物不存在或已经召唤出，系统会自动提示

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|idx     |`integer`    |否   |    |   宠物序号 |

### 收回宠物
`unrecallpet`

> 收回idx号宠物，如宠物不存在或已经收回，系统会自动提示

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|idx     |`integer`    |否   |    |   宠物序号 |

### 返回复活的宠物对象
`realivepet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|idx     |`integer`    |否   |    |   宠物序号 |
|nHp     |`integer`    |否   |    |   复活后的HP量 |
|type     |`integer`    |否   |    |   0-绝对值，1-百分比 |

### 删除宠物

`delpet`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|idx     |`integer`    |否   |    |   宠物序号 |

### 收回宠物为物品

`retractpettoitem`

> 存入背包，如背包满则删除宠物

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|idx     |`integer`    |否   |    |   宠物序号 |

### 宠物穿装备
`pettakeon`

> 此接口不会增加物品，仅将物品的属性添加到宠物身上，并保存到数据库。

| 参数 | 类型      | 空   | 默认 | 注释                      |
| :--- | :-------- | :--- | :--- | :------------------------ |
| play | `object`  | 否   |      | 玩家对象                  |
| idx  | `integer` | 否   |      | 宠物序号                  |
| item | `string`  | 否   |      | 装备名称，多个装备用#分隔 |

### 宠物脱装备

`pettakeoff`

> 此接口不扣减物品，仅扣减宠物身上对应装备属性。

| 参数 | 类型      | 空   | 默认 | 注释                                          |
| :--- | :-------- | :--- | :--- | :-------------------------------------------- |
| play | `object`  | 否   |      | 玩家对象                                      |
| idx  | `integer` | 否   |      | 宠物序号                                      |
| item | `string`  | 否   |      | 装备名称，多个装备用#分隔，-1表示脱下全部装备 |

### 获取宠物身上装备列表

`getpetbodyitem`

| 参数 | 类型      | 空   | 默认 | 注释     |
| :--- | :-------- | :--- | :--- | :------- |
| play | `object`  | 否   |      | 玩家对象 |
| idx  | `integer` | 否   |      | 宠物序号 |

### 置换宠物属性

`petmon`
- 只置换基础属性:形象、怪物表配置，原宠物其它属性全部保留，包括序号

| 参数   | 类型      | 空   | 默认 | 注释     |
| :----- | :-------- | :--- | :--- | :------- |
| play   | `object`  | 否   |      | 玩家对象 |
| idx    | `integer` | 否   |      | 宠物序号 |
| monidx | `integer` | 否   |      | 怪物IDX  |

### 设置宠物模式

`setpetmode`
- 注：设置宠物是针对所有宠物同时生效，如果主人有宝宝，则宝宝同步生效（宝宝也支持此命令）

| 参数 | 类型      | 空   | 默认 | 注释                                                                     |
| :--- | :-------- | :--- | :--- | :----------------------------------------------------------------------- |
| play | `object`  | 否   |      | 玩家对象                                                                 |
| mode | `integer` | 否   |      | 宠物模式:<br>1-跟随;<br>2-攻击;<br>3-被动(被攻击时才设定目标);<br>4-休息 |

### 获取宠物状态

`petstate`

|参数|类型|空|默认|注释|
|:----    |:-------    |:--- |----|------      |
|play     |`object`    |否   |    |   玩家对象 |
|idx     |`integer`    |否   |    |   宠物序号 |
|result     |`integer`      | 否  |    |宠物状态：<br>0-收回状态，<br>1-召唤出状态，<br>2-死亡状态

### 增加宠物属性

`addpetattlist`

| 参数     | 类型               | 空   | 默认 | 注释           |
| :------- | :----------------- | :--- | :--- | :------------- |
| play     | `object`           | 否   |      | 玩家对象       |
| idx      | `integer`          | 否   |      | 宠物序号       |
| attrName | `integer`/`string` | 否   |      | 自定义属性组名 |
| opt      | `string`           | 否   |      | 操作符 + - =   |
| attr     | `string`           | 否   |      | 属性字符串     |

### 清除宠物属性

`delpetattlist`

| 参数     | 类型               | 空   | 默认 | 注释                                       |
| :------- | :----------------- | :--- | :--- | :----------------------------------------- |
| play     | `object`           | 否   |      | 玩家对象                                   |
| idx      | `integer`          | 否   |      | 宠物序号                                   |
| attrName | `integer`/`string` | 否   |      | 清空对应属性组的属性;<br>nil清除所有属性组 |

### 增加宠物攻击表现

`addpetskill`

| 参数    | 类型      | 空   | 默认 | 注释                                      |
| :------ | :-------- | :--- | :--- | :---------------------------------------- |
| play    | `object`  | 否   |      | 玩家对象                                  |
| idx     | `integer` | 否   |      | 宠物序号或'X'表示当前宠物                 |
| skillid | `integer` | 否   |      | 增加的攻击表现ID，为cfg_monattack表中的ID |

### 删除宠物攻击表现

`delpetskill`

| 参数    | 类型      | 空   | 默认 | 注释                                      |
| :------ | :-------- | :--- | :--- | :---------------------------------------- |
| play    | `object`  | 否   |      | 玩家对象                                  |
| idx     | `integer` | 否   |      | 宠物序号或'X'表示当前宠物                 |
| skillid | `integer` | 否   |      | 增加的攻击表现ID，为cfg_monattack表中的ID |

### 获取宠物数量

`getpetcount`

> **<font color="#808080" style="font-size: 13px;">引擎64_24.03.14新增接口</font>**

| 参数   | 类型      | 空   | 默认 | 注释     |
| :----- | :-------- | :--- | :--- | :------- |
| play   | `object`  | 否   |      | 玩家对象 |
| result | `integer` | 否   |      | 宠物数量 |

### 改变宠物外观

`setpetappr`

> **<font color="#808080" style="font-size: 13px;">引擎64_24.05.23新增接口</font>**

| 参数   | 类型               | 空   | 默认 | 注释                           |
| :----- | :----------------- | :--- | :--- | :----------------------------- |
| actor  | `string`           | 否   |      | 玩家对象                       |
| petIdx | `string`/`integer` | 否   |      | 宠物序号,X表示当前宠物         |
| appr   | `integer`          | 是   |      | 怪物外观ID(怪物Appr)<br>0=还原 |

